---
description: Project structure and file organization guidelines for the Profolio monorepo
ruleType: always
alwaysApply: true
---

# Project Structure

## Main Structure

- We use a frontend/backend monorepo structure with pnpm workspaces
- Frontend is a Next.js application in `frontend/`
- Backend is a NestJS application in `backend/`
- Root level contains deployment and setup scripts

```tree
.
â”œâ”€â”€ frontend/                # Next.js application
â”‚   â”œâ”€â”€ src/                 # Source code
â”‚   â”‚   â”œâ”€â”€ app/            # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/     # Authentication routes
â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/ # Main dashboard routes
â”‚   â”‚   â”‚   â”œâ”€â”€ api/        # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css # Global styles
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx  # Root layout
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx    # Homepage
â”‚   â”‚   â”‚   â””â”€â”€ loading.tsx # Loading UI
â”‚   â”‚   â”œâ”€â”€ components/     # React components
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/         # Radix UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ charts/     # Chart components
â”‚   â”‚   â”‚   â”œâ”€â”€ forms/      # Form components
â”‚   â”‚   â”‚   â””â”€â”€ ...         # Other reusable components
â”‚   â”‚   â”œâ”€â”€ hooks/          # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ lib/           # Utility functions
â”‚   â”‚   â”œâ”€â”€ types/         # TypeScript type definitions
â”‚   â”‚   â”œâ”€â”€ styles/        # CSS architecture
â”‚   â”‚   â”‚   â”œâ”€â”€ main.css   # Main CSS entry with Tailwind imports
â”‚   â”‚   â”‚   â”œâ”€â”€ foundation/ # Core design tokens
â”‚   â”‚   â”‚   â”œâ”€â”€ components/ # Component-specific styles
â”‚   â”‚   â”‚   â”œâ”€â”€ themes/    # Theme definitions
â”‚   â”‚   â”‚   â””â”€â”€ utilities/ # Utility classes
â”‚   â”‚   â””â”€â”€ providers/     # React Context providers
â”‚   â”œâ”€â”€ e2e/               # Playwright E2E tests
â”‚   â”‚   â”œâ”€â”€ auth.spec.ts   # Authentication & security tests
â”‚   â”‚   â”œâ”€â”€ portfolio.spec.ts # Portfolio management tests
â”‚   â”‚   â””â”€â”€ performance.spec.ts # Performance & accessibility tests
â”‚   â”œâ”€â”€ public/            # Static assets
â”‚   â”œâ”€â”€ .next/             # Next.js build output
â”‚   â”œâ”€â”€ package.json       # Frontend dependencies
â”‚   â”œâ”€â”€ next.config.js     # Next.js configuration
â”‚   â”œâ”€â”€ playwright.config.ts # Playwright E2E configuration
â”‚   â”œâ”€â”€ vitest.config.ts   # Vitest unit test configuration
â”‚   â”œâ”€â”€ tailwind.config.ts # Tailwind configuration
â”‚   â”œâ”€â”€ tsconfig.json      # TypeScript configuration
â”‚   â””â”€â”€ components.json    # Radix UI configuration
â”œâ”€â”€ backend/               # NestJS application
â”‚   â”œâ”€â”€ src/              # Source code
â”‚   â”‚   â”œâ”€â”€ modules/      # Feature modules
â”‚   â”‚   â”œâ”€â”€ common/       # Shared utilities
â”‚   â”‚   â”œâ”€â”€ config/       # Configuration files
â”‚   â”‚   â”œâ”€â”€ decorators/   # Custom decorators
â”‚   â”‚   â”œâ”€â”€ guards/       # Authentication guards
â”‚   â”‚   â”œâ”€â”€ interceptors/ # Request/response interceptors
â”‚   â”‚   â”œâ”€â”€ middleware/   # Custom middleware
â”‚   â”‚   â”œâ”€â”€ pipes/        # Validation pipes
â”‚   â”‚   â”œâ”€â”€ app.module.ts # Root module
â”‚   â”‚   â””â”€â”€ main.ts       # Application entry point
â”‚   â”œâ”€â”€ prisma/           # Prisma schema and migrations
â”‚   â”‚   â”œâ”€â”€ schema.prisma # Database schema
â”‚   â”‚   â””â”€â”€ migrations/   # Database migrations
â”‚   â”œâ”€â”€ dist/             # Build output
â”‚   â”œâ”€â”€ package.json      # Backend dependencies
â”‚   â”œâ”€â”€ tsconfig.json     # TypeScript configuration
â”‚   â””â”€â”€ nest-cli.json     # NestJS CLI configuration
â”œâ”€â”€ scripts/              # Deployment and utility scripts
â”œâ”€â”€ docs/                 # Documentation
â”‚   â”œâ”€â”€ security/         # Security policies and guidelines
â”‚   â”‚   â””â”€â”€ SECURITY.md   # Security policy and vulnerability reporting
â”‚   â”œâ”€â”€ testing/          # Testing documentation
â”‚   â”œâ”€â”€ processes/        # Development processes
â”‚   â”œâ”€â”€ releases/         # Release notes by version
â”‚   â”œâ”€â”€ setup/            # Installation and setup guides
â”‚   â””â”€â”€ architecture/     # System architecture documentation
â”œâ”€â”€ .github/              # GitHub Actions workflows
â”‚   â””â”€â”€ workflows/        # CI/CD pipelines
â”‚       â”œâ”€â”€ ci.yml        # Continuous integration
â”‚       â”œâ”€â”€ e2e-tests.yml # E2E testing workflow
â”‚       â””â”€â”€ pre-release-validation.yml # Pre-release testing
â”œâ”€â”€ package.json          # Root package.json
â”œâ”€â”€ docker-compose.prod.yml # Production Docker setup
â”œâ”€â”€ Dockerfile           # Docker configuration
â””â”€â”€ ... (config files)
```

## File Naming and Organization

- Use kebab-case for route directories (e.g., `app/portfolio-analysis/page.tsx`)
- Use PascalCase for components (e.g. `components/PortfolioChart.tsx`)
- Radix UI components are in `components/ui/`
- All other components are in `components/` with feature-based subdirectories
- Colocate files in the folder where they're used unless they can be reused across the app
- If a component can be used in many places, place it in the `components/` folder

## New Pages

- Create new pages at: `frontend/src/app/PAGE_NAME/page.tsx`
- Components for the page are either in `page.tsx` or in the `frontend/src/app/PAGE_NAME/` folder
- Pages are Server components for direct data loading when possible
- Use TanStack Query for data fetching in client components
- Components with `onClick` or other interactions must be client components with `"use client"` directive
- Server action files must start with `"use server"`

## API Routes

- Frontend API routes are in `frontend/src/app/api/`
- Backend API endpoints are in `backend/src/modules/`
- Use Next.js API routes for frontend-specific logic and authentication
- Use NestJS backend for main business logic and database operations

## Utility Functions

- Create utility functions in `frontend/src/lib/` folder for reusable logic
- Use lodash utilities for common operations (arrays, objects, strings)
- Import specific lodash functions to minimize bundle size:
  ```ts
  import groupBy from "lodash/groupBy";
  ```

## Backend Structure

- Use NestJS modules for feature organization
- Database operations use Prisma ORM
- Authentication and authorization handled by guards
- Validation handled by pipes and DTOs

## Testing Structure

### **Required Test Organization**

- **Unit Tests**: Colocated with source files (`*.test.ts` next to `*.ts`)
- **E2E Tests**: In `frontend/e2e/` directory with Playwright
- **Security Tests**: Tagged with `@security` in E2E tests
- **Performance Tests**: Lighthouse CI integration and k6 load testing

### **Data-TestID Requirements**

- All interactive components MUST have `data-testid` attributes
- Use descriptive names: `data-testid="add-asset-button"`
- Required for all buttons, forms, navigation elements

### **Mandatory Tests For:**

- ğŸ›¡ï¸ **Authentication flows** - Security and bypass testing
- ğŸ’° **Financial calculations** - Accuracy and precision testing
- ğŸ” **Security features** - Input validation and injection testing
- ğŸ“Š **Critical business logic** - Portfolio operations
- ğŸ”Œ **API endpoints** - Integration and security testing
- ğŸ’³ **Payment/transaction logic** - Financial accuracy testing
