#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook to prevent commits with TypeScript and ESLint errors

echo "ğŸ” Running pre-commit checks..."

# Check if we're in a frontend directory change
if git diff --cached --name-only | grep -q "^frontend/"; then
  echo "ğŸ“ Checking TypeScript types..."
  cd frontend
  
  # Run TypeScript check
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript errors found. Please fix them before committing."
    echo "ğŸ’¡ Tip: Run 'npm run type-check' in the frontend directory to see all errors."
    exit 1
  fi
  
  echo "ğŸ¨ Checking ESLint rules..."
  # Run ESLint on staged files only
  npx eslint --ext .ts,.tsx $(git diff --cached --name-only --relative | grep -E '\.(ts|tsx)$')
  if [ $? -ne 0 ]; then
    echo "âŒ ESLint errors found. Please fix them before committing."
    echo "ğŸ’¡ Tip: Run 'npm run lint' in the frontend directory to see all errors."
    exit 1
  fi
  
  cd ..
fi

echo "âœ… All checks passed!"