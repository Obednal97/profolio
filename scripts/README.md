# Profolio Development Scripts

This directory contains automated scripts for development environment setup, validation, and maintenance.

## 🚀 **Setup Scripts**

### `setup-dev-environment.sh`

**One-command setup for new team members**

```bash
./scripts/setup-dev-environment.sh
```

**What it does:**

- ✅ Verifies Node.js version (v18.17.0+)
- ✅ Installs/updates pnpm to v9.14.4
- ✅ Installs backend dependencies
- ✅ Generates Prisma client
- ✅ Creates .env from template (if needed)
- ✅ Installs frontend dependencies
- ✅ Verifies TypeScript compilation
- ✅ Checks ESLint configuration
- ✅ Creates validation script

**Usage:**

```bash
# From project root
chmod +x scripts/setup-dev-environment.sh
./scripts/setup-dev-environment.sh
```

### `validate-environment.sh`

**Environment validation and health check**

```bash
./scripts/validate-environment.sh
```

**What it checks:**

- ✅ pnpm version (must be 9.14.4)
- ✅ Backend .env file exists
- ✅ Backend TypeScript compilation
- ✅ Prisma client generation
- ✅ Frontend TypeScript compilation
- ✅ React Hook dependency warnings

**Auto-generated by:** `setup-dev-environment.sh`

## 🔧 **Release Scripts**

### `prepare-release.mjs`

**Automated release preparation and documentation creation**

```bash
node scripts/prepare-release.mjs v1.14.0
```

**What it does:**

- ✅ Updates all package.json files with new version
- ✅ Creates CHANGELOG.md entry template
- ✅ Creates release notes file template in docs/releases/
- ✅ Updates service worker version (PWA cache invalidation)
- ✅ Updates README.md version examples
- ✅ Validates builds (frontend and backend)
- ✅ Creates directory structure for release notes
- ✅ Checks git status and date chronology

**Usage:**

```bash
# Prepare release for v1.14.0
node scripts/prepare-release.mjs v1.14.0

# With or without 'v' prefix
node scripts/prepare-release.mjs 1.14.0

# Show help
node scripts/prepare-release.mjs --help
```

**Output:**
- Creates templates for both CHANGELOG.md and release notes
- Shows next steps for completing the release
- Provides git commands for tagging and pushing

### `validate-release-sync.mjs`

**Release documentation synchronization validator**

```bash
node scripts/validate-release-sync.mjs
```

**What it checks:**

- ✅ Every CHANGELOG.md version has corresponding release notes
- ✅ No orphaned release notes without CHANGELOG entries
- ✅ Dates match between CHANGELOG and release notes
- ✅ docs/releases/README.md shows correct current version
- ✅ Version numbering consistency

**Usage:**

```bash
# Run validation
node scripts/validate-release-sync.mjs

# Should be run before every release
# Exit code 0 = success, 1 = errors found
```

**Common issues detected:**
- Missing release notes for CHANGELOG entries
- Orphaned release notes files
- Date mismatches between documentation
- Outdated current version in docs/releases/README.md

### `check-release-date.sh`

**Release date validation**

Validates release dates and version consistency.

## 📋 **Script Usage Guidelines**

### **For New Team Members**

1. Clone the repository
2. Run: `./scripts/setup-dev-environment.sh`
3. Follow the prompts to complete setup
4. Use: `./scripts/validate-environment.sh` anytime to check health

### **For Regular Development**

```bash
# Quick environment check
./scripts/validate-environment.sh

# After pulling changes
pnpm install  # In both backend/ and frontend/
pnpm prisma generate  # In backend/ if schema changed

# Before committing
pnpm run lint          # Fix React Hook warnings
pnpm run type-check    # Fix TypeScript errors
pnpm run build         # Ensure build succeeds
```

### **For Creating Releases**

```bash
# 1. Prepare the release
node scripts/prepare-release.mjs v1.14.0

# 2. Complete the generated templates:
#    - Edit CHANGELOG.md (high-level summary)
#    - Edit docs/releases/v1/v1.14/RELEASE_NOTES_v1.14.0.md (detailed)

# 3. Validate synchronization
node scripts/validate-release-sync.mjs

# 4. Commit and tag
git add -A
git commit -m "feat: v1.14.0 - Brief description"
git tag -a v1.14.0 -m "Release v1.14.0"

# 5. Push to GitHub
git push origin main --tags

# 6. Create GitHub release
gh release create v1.14.0 --title "v1.14.0 - Title" --notes-file docs/releases/v1/v1.14/RELEASE_NOTES_v1.14.0.md
```

### **Troubleshooting**

If any script fails:

1. **Permission Issues**

   ```bash
   chmod +x scripts/*.sh
   ```

2. **pnpm Not Found**

   ```bash
   npm install -g pnpm@9.14.4
   ```

3. **Prisma Issues**

   ```bash
   cd backend && pnpm prisma generate
   ```

4. **Build Issues**
   ```bash
   rm -rf .next node_modules
   pnpm install
   pnpm run build
   ```

## 🔍 **Expected Output**

### **Successful Setup**

```bash
🚀 Setting up Profolio development environment...
==================================================
✅ Node.js version v18.17.0 is compatible
✅ pnpm 9.14.4 is ready
✅ Backend dependencies installed
✅ Prisma client generation successful
✅ Backend TypeScript compilation successful
✅ Frontend dependencies installed
✅ Frontend TypeScript compilation successful
✅ ESLint passes with no warnings

🎉 Environment validation successful! You're ready to develop.
```

### **Successful Validation**

```bash
🔍 Validating Profolio development environment...
✅ pnpm version correct: 9.14.4
✅ Backend .env file exists
✅ Backend TypeScript compilation successful
✅ Prisma client generation successful
✅ Frontend TypeScript compilation successful
✅ No React Hook warnings found

🎉 Environment validation successful! You're ready to develop.
```

## 🚨 **Common Issues & Solutions**

### **Issue: React Hook Warnings**

```bash
⚠️  Found 3 React Hook warnings - run 'pnpm run lint' to see details
```

**Solution:**

```bash
cd frontend
pnpm run lint  # See specific warnings
# Fix missing dependencies in useEffect, useCallback, useMemo
```

### **Issue: Prisma Client Not Generated**

```bash
❌ Prisma client generation failed
```

**Solution:**

```bash
cd backend
pnpm prisma generate
pnpm run type-check  # Verify fix
```

### **Issue: TypeScript Compilation Failed**

```bash
❌ Backend TypeScript compilation failed
```

**Solution:**

```bash
# Check for missing environment variables
cat backend/.env

# Ensure all required variables are set:
# - JWT_SECRET
# - API_ENCRYPTION_KEY
# - DATABASE_URL
```

## 📚 **Related Documentation**

- [Team Development Setup Guide](../docs/development/TEAM_DEVELOPMENT_SETUP.md)
- [Package Manager Migration](../docs/development/PACKAGE_MANAGER_MIGRATION.md)
- [Code Quality Checklist](../docs/processes/CODE_QUALITY_CHECKLIST.md)

## 🔄 **Script Maintenance**

### **Adding New Scripts**

1. Create script in `scripts/` directory
2. Make executable: `chmod +x scripts/your-script.sh`
3. Update this README
4. Test thoroughly before committing

### **Updating Existing Scripts**

1. Test changes locally
2. Update version comments in script
3. Update this README if behavior changes
4. Verify with fresh environment

---

**💡 Pro Tip**: Bookmark `./scripts/validate-environment.sh` - run it whenever something feels off with your development environment!
